import time
import random
import queue

# ----------------------------------------------------------
# Game Task Class
# ----------------------------------------------------------

class GameTask:
    """Simulates a subsystem (thread) in the game engine."""

    def __init__(self, name, total_time):
        self.name = name
        self.remaining_time = total_time

    def execute(self, time_slice):
        """Runs the task for one CPU time slice."""
        if self.remaining_time <= 0:
            return True

        run_time = min(self.remaining_time, time_slice)
        print(f"âš™ï¸  {self.name} running for {run_time:.2f}s...")
        time.sleep(0.1)
        self.remaining_time -= run_time

        if self.remaining_time <= 0:
            print(f"âœ… {self.name} completed!\n")
            return True
        else:
            print(f"â¸ {self.name} paused with {self.remaining_time:.2f}s remaining.\n")
            return False


# ----------------------------------------------------------
# CPU Scheduler
# ----------------------------------------------------------

def cpu_scheduler(task_queue, time_slice):
    """Simulates Round-Robin CPU Scheduling."""
    print("\nðŸ§  CPU Scheduler: Starting Round-Robin Scheduling\n")

    while not task_queue.empty():
        task = task_queue.get()
        finished = task.execute(time_slice)
        if not finished:
            task_queue.put(task)
        time.sleep(0.2)

    print("âœ… All Engine Tasks Completed!\n")


# ----------------------------------------------------------
# Memory Manager
# ----------------------------------------------------------

def memory_manager():
    """Simulates memory usage and cleanup."""
    print("\nðŸ’¾ Memory Management System\n")
    total_memory = 4096  # MB
    used_memory = random.randint(1000, 2000)

    for frame in range(1, 6):
        fluctuation = random.randint(-200, 300)
        used_memory = max(800, min(total_memory, used_memory + fluctuation))
        print(f"Frame {frame}: Used {used_memory} MB | Free {total_memory - used_memory} MB")
        time.sleep(0.3)

    print("â™»ï¸  Garbage Collector freed unused textures and meshes.\n")


# ----------------------------------------------------------
# Game Loop
# ----------------------------------------------------------

def game_loop(num_frames):
    """Simulates a 60 FPS game loop."""
    print("\nðŸŽ® GAME LOOP (60 FPS Target)\n")
    fps = 60
    frame_time = 1 / fps

    for frame in range(1, num_frames + 1):
        print(f"ðŸŒ€ Frame {frame}: Updating Render | Physics | Audio | AI")
        time.sleep(frame_time * random.uniform(2, 4))

    print("\nðŸ Game Loop Finished.\n")


# ----------------------------------------------------------
# Main Function
# ----------------------------------------------------------

def main():
    print("=" * 60)
    print("ðŸ§© GAME ENGINE Ã— OPERATING SYSTEM SIMULATION (INTERACTIVE) ðŸ§©")
    print("=" * 60)

    # --- USER INPUTS ---
    try:
        num_tasks = int(input("Enter number of subsystems (1â€“10): "))
        time_slice = float(input("Enter CPU time slice (in seconds): "))
        min_exec = float(input("Enter minimum execution time per task (s): "))
        max_exec = float(input("Enter maximum execution time per task (s): "))
        num_frames = int(input("Enter number of frames to simulate (5â€“30): "))
    except ValueError:
        print("âŒ Invalid input. Please enter valid numbers.")
        return

    if num_tasks <= 0 or time_slice <= 0 or min_exec <= 0 or max_exec <= 0:
        print("âŒ Values must be greater than zero.")
        return

    # --- MEMORY MANAGEMENT ---
    memory_manager()

    # --- TASK CREATION ---
    print("\nðŸ§® Creating Game Engine Subsystems...\n")
    task_queue = queue.Queue()

    for i in range(num_tasks):
        exec_time = random.uniform(min_exec, max_exec)
        task_queue.put(GameTask(f"Subsystem-{i+1}", exec_time))
        print(f"ðŸ”§ Created Subsystem-{i+1} | Execution Time: {exec_time:.2f}s")

    # --- CPU SCHEDULING ---
    cpu_scheduler(task_queue, time_slice)

    # --- GAME LOOP ---
    game_loop(num_frames)

    print("ðŸŽ¯ Simulation Complete â€“ Game Engine and OS Interaction Demonstrated!")
    print("=" * 60)


# ----------------------------------------------------------
# Entry Point
# ----------------------------------------------------------

if __name__ == "__main__":
    main()
